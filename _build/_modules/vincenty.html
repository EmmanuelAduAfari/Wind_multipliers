

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>vincenty &mdash; Wind Multipliers v0.3 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Wind Multipliers v0.3 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">Wind Multipliers v0.3 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for vincenty</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">NX</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s">&#39;1.0.1&#39;</span>
<div class="viewcode-block" id="GreatCircle"><a class="viewcode-back" href="../docs/shielding.html#vincenty.GreatCircle">[docs]</a><span class="k">class</span> <span class="nc">GreatCircle</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    formula for perfect sphere from Ed Williams&#39; &#39;Aviation Formulary&#39;</span>
<span class="sd">    (http://williams.best.vwh.net/avform.htm)</span>

<span class="sd">    code for ellipsoid posted to GMT mailing list by Jim Leven in Dec 1999</span>

<span class="sd">    Contact: Jeff Whitaker &lt;jeffrey.s.whitaker@noaa.gov&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rmajor</span><span class="p">,</span><span class="n">rminor</span><span class="p">,</span><span class="n">lon1</span><span class="p">,</span><span class="n">lat1</span><span class="p">,</span><span class="n">lon2</span><span class="p">,</span><span class="n">lat2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define a great circle by specifying:</span>
<span class="sd">        rmajor - radius of major axis of ellipsoid</span>
<span class="sd">        rminor - radius of minor axis of ellipsoid.</span>
<span class="sd">        lon1 - starting longitude of great circle</span>
<span class="sd">        lat1 - starting latitude</span>
<span class="sd">        lon2 - ending longitude</span>
<span class="sd">        lat2 - ending latitude</span>
<span class="sd">        All must be given in degrees.</span>

<span class="sd">        Instance variables:</span>
<span class="sd">        distance - distance along great circle in radians.</span>
<span class="sd">        lon1,lat1,lon2,lat2 - start and end points (in radians).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># convert to radians from degrees.</span>
        <span class="n">lat1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span>
        <span class="n">lon1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon1</span><span class="p">)</span>
        <span class="n">lat2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span>
        <span class="n">lon2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">rmajor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmajor</span><span class="o">-</span><span class="n">rminor</span><span class="p">)</span><span class="o">/</span><span class="n">rmajor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat1</span> <span class="o">=</span> <span class="n">lat1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat2</span> <span class="o">=</span> <span class="n">lat2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon1</span> <span class="o">=</span> <span class="n">lon1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon2</span> <span class="o">=</span> <span class="n">lon2</span>
        <span class="c"># distance along geodesic in meters.</span>
        <span class="n">d</span><span class="p">,</span><span class="n">a12</span><span class="p">,</span><span class="n">a21</span> <span class="o">=</span> <span class="n">vinc_dist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span>  <span class="n">lat1</span><span class="p">,</span>  <span class="n">lon1</span><span class="p">,</span>  <span class="n">lat2</span><span class="p">,</span>  <span class="n">lon2</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">azimuth12</span> <span class="o">=</span> <span class="n">a12</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">azimuth21</span> <span class="o">=</span> <span class="n">a21</span>
        <span class="c"># great circle arc-length distance (in radians).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gcarclen</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">lat1</span><span class="o">-</span><span class="n">lat2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>\
        <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">lon1</span><span class="o">-</span><span class="n">lon2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="c"># check to see if points are antipodal (if so, route is undefined).</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gcarclen</span> <span class="o">==</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">antipodal</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">antipodal</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="GreatCircle.points"><a class="viewcode-back" href="../docs/shielding.html#vincenty.GreatCircle.points">[docs]</a>    <span class="k">def</span> <span class="nf">points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">npoints</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        compute arrays of npoints equally spaced</span>
<span class="sd">        intermediate points along the great circle.</span>

<span class="sd">        input parameter npoints is the number of points</span>
<span class="sd">        to compute.</span>

<span class="sd">        Returns lons, lats (lists with longitudes and latitudes</span>
<span class="sd">        of intermediate points in degrees).</span>

<span class="sd">        For example npoints=10 will return arrays lons,lats of 10</span>
<span class="sd">        equally spaced points along the great circle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># must ask for at least 2 points.</span>
        <span class="k">if</span> <span class="n">npoints</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">,</span><span class="s">&#39;npoints must be greater than 1&#39;</span>
        <span class="k">elif</span> <span class="n">npoints</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon1</span><span class="p">),</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon2</span><span class="p">)],[</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat1</span><span class="p">),</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat2</span><span class="p">)]</span>
        <span class="c"># can&#39;t do it if endpoints are antipodal, since</span>
        <span class="c"># route is undefined.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">antipodal</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">,</span><span class="s">&#39;cannot compute intermediate points on a great circle whose endpoints are antipodal&#39;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gcarclen</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">npoints</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">delta</span><span class="o">*</span><span class="n">NX</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npoints</span><span class="p">)</span> <span class="c"># f=0 is point 1, f=1 is point 2.</span>
        <span class="n">incdist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="o">/</span><span class="p">(</span><span class="n">npoints</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lat1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat1</span>
        <span class="n">lat2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat2</span>
        <span class="n">lon1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon1</span>
        <span class="n">lon2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon2</span>
        <span class="c"># perfect sphere, use great circle formula</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">NX</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">f</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">NX</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">f</span><span class="o">*</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lon1</span><span class="p">)</span><span class="o">+</span><span class="n">B</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lon2</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lon1</span><span class="p">)</span><span class="o">+</span><span class="n">B</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lon2</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span>               <span class="o">+</span><span class="n">B</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span>
            <span class="n">lats</span><span class="o">=</span><span class="n">NX</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">NX</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">lons</span><span class="o">=</span><span class="n">NX</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">,</span><span class="n">lons</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">,</span><span class="n">lats</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="c"># use ellipsoid formulas</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">latpt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat1</span>
            <span class="n">lonpt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon1</span>
            <span class="n">azimuth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">azimuth12</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">lonpt</span><span class="p">)]</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">latpt</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">latptnew</span><span class="p">,</span> <span class="n">lonptnew</span><span class="p">,</span> <span class="n">alpha21</span><span class="o">=</span><span class="n">vinc_pt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="n">latpt</span><span class="p">,</span><span class="n">lonpt</span><span class="p">,</span><span class="n">azimuth</span><span class="p">,</span><span class="n">incdist</span><span class="p">)</span>
                <span class="n">d</span><span class="p">,</span><span class="n">azimuth</span><span class="p">,</span> <span class="n">a21</span><span class="o">=</span><span class="n">vinc_dist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="n">latptnew</span><span class="p">,</span><span class="n">lonptnew</span><span class="p">,</span><span class="n">lat2</span><span class="p">,</span><span class="n">lon2</span><span class="p">)</span>
                <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">latptnew</span><span class="p">))</span>
                <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">lonptnew</span><span class="p">))</span>
                <span class="n">latpt</span> <span class="o">=</span> <span class="n">latptnew</span><span class="p">;</span> <span class="n">lonpt</span> <span class="o">=</span> <span class="n">lonptnew</span>
            <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon2</span><span class="p">))</span>
            <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">lons</span><span class="p">,</span><span class="n">lats</span>

<span class="c"># ---------------------------------------------------------------------</span>
<span class="c"># |                                                                    |</span>
<span class="c"># |     geodetic.py -  a collection of geodetic functions              |</span>
<span class="c"># |                                                                    |</span>
<span class="c"># ---------------------------------------------------------------------</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># ----------------------------------------------------------------------</span>
<span class="c"># | Algrothims from Geocentric Datum of Australia Technical Manual      |</span>
<span class="c"># |                                                                     |</span>
<span class="c"># | http://www.anzlic.org.au/icsm/gdatum/chapter4.html                  |</span>
<span class="c"># |                                                                     |</span>
<span class="c"># | This page last updated 11 May 1999                                  |</span>
<span class="c"># |                                                                     |</span>
<span class="c"># | Computations on the Ellipsoid                                       |</span>
<span class="c"># |                                                                     |</span>
<span class="c"># | There are a number of formulae that are available                   |</span>
<span class="c"># | to calculate accurate geodetic positions,                           |</span>
<span class="c"># | azimuths and distances on the ellipsoid.                            |</span>
<span class="c"># |                                                                     |</span>
<span class="c"># | Vincenty&#39;s formulae (Vincenty, 1975) may be used                    |</span>
<span class="c"># | for lines ranging from a few cm to nearly 20,000 km,                |</span>
<span class="c"># | with millimetre accuracy.                                           |</span>
<span class="c"># | The formulae have been extensively tested                           |</span>
<span class="c"># | for the Australian region, by comparison with results               |</span>
<span class="c"># | from other formulae (Rainsford, 1955 &amp; Sodano, 1965).               |</span>
<span class="c"># |                                                                     |</span>
<span class="c"># | * Inverse problem: azimuth and distance from known                  |</span>
<span class="c"># |                     latitudes and longitudes                        |</span>
<span class="c"># | * Direct problem: Latitude and longitude from known                 |</span>
<span class="c"># |                     position, azimuth and distance.                 |</span>
<span class="c"># | * Sample data                                                       |</span>
<span class="c"># | * Excel spreadsheet                                                 |</span>
<span class="c"># |                                                                     |</span>
<span class="c"># | Vincenty&#39;s Inverse formulae                                         |</span>
<span class="c"># | Given: latitude and longitude of two points                         |</span>
<span class="c"># |                     (phi1, lembda1 and phi2, lembda2),              |</span>
<span class="c"># | Calculate: the ellipsoidal distance (s) and                         |</span>
<span class="c"># | forward and reverse azimuths between the points (alpha12, alpha21). |</span>
<span class="c"># |                                                                     |</span>
<span class="c"># ----------------------------------------------------------------------</span>
</div></div>
<div class="viewcode-block" id="vinc_dist"><a class="viewcode-back" href="../docs/shielding.html#vincenty.vinc_dist">[docs]</a><span class="k">def</span> <span class="nf">vinc_dist</span><span class="p">(</span>  <span class="n">f</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">phi1</span><span class="p">,</span>  <span class="n">lembda1</span><span class="p">,</span>  <span class="n">phi2</span><span class="p">,</span>  <span class="n">lembda2</span> <span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the distance between two geographic points on the ellipsoid</span>
<span class="sd">    and the forward and reverse azimuths between these points.</span>
<span class="sd">    lats, longs and azimuths are in radians, distance in metres</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        f: flattening</span>
<span class="sd">        a: equatorial radius (metres)</span>
<span class="sd">        phi1: latitude of first point</span>
<span class="sd">        lembda1: longitude of first point</span>
<span class="sd">        phi2: latitude of second point</span>
<span class="sd">        lembda2: longitude of second point</span>
<span class="sd">        </span>
<span class="sd">    Returns ( s, alpha12,  alpha21 ) as a tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span> <span class="n">phi2</span> <span class="o">-</span> <span class="n">phi1</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-8</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">lembda2</span> <span class="o">-</span> <span class="n">lembda1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-8</span> <span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>

    <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">f</span><span class="p">)</span>

    <span class="n">TanU1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">f</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span> <span class="n">phi1</span> <span class="p">)</span>
    <span class="n">TanU2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">f</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span> <span class="n">phi2</span> <span class="p">)</span>

    <span class="n">U1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">TanU1</span><span class="p">)</span>
    <span class="n">U2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">TanU2</span><span class="p">)</span>

    <span class="n">lembda</span> <span class="o">=</span> <span class="n">lembda2</span> <span class="o">-</span> <span class="n">lembda1</span>
    <span class="n">last_lembda</span> <span class="o">=</span> <span class="o">-</span><span class="mf">4000000.0</span>                <span class="c"># an impossibe value</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">lembda</span>

    <span class="c"># Iterate the following equations,</span>
    <span class="c">#  until there is no significant change in lembda</span>

    <span class="k">while</span> <span class="p">(</span> <span class="n">last_lembda</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">3000000.0</span> <span class="ow">or</span> <span class="n">lembda</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span> <span class="p">(</span><span class="n">last_lembda</span> <span class="o">-</span> <span class="n">lembda</span><span class="p">)</span><span class="o">/</span><span class="n">lembda</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.0e-9</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">sqr_sin_sigma</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lembda</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="nb">pow</span><span class="p">(</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">U2</span><span class="p">)</span> <span class="o">-</span> \
            <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span>  <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lembda</span><span class="p">)</span> <span class="p">),</span> <span class="mi">2</span> <span class="p">)</span>

        <span class="n">Sin_sigma</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">sqr_sin_sigma</span> <span class="p">)</span>

        <span class="n">Cos_sigma</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">U2</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lembda</span><span class="p">)</span>

        <span class="n">sigma</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span> <span class="n">Sin_sigma</span><span class="p">,</span> <span class="n">Cos_sigma</span> <span class="p">)</span>

        <span class="n">Sin_alpha</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lembda</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span> <span class="n">Sin_alpha</span> <span class="p">)</span>

        <span class="n">Cos2sigma_m</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">U2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">pow</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="mi">16</span><span class="p">)</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">+</span> <span class="n">f</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="mi">2</span><span class="p">)))</span>

        <span class="n">last_lembda</span> <span class="o">=</span> <span class="n">lembda</span>

        <span class="n">lembda</span> <span class="o">=</span> <span class="n">omega</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">C</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">Cos2sigma_m</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">Cos2sigma_m</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">)))</span>

    <span class="n">u2</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>

    <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">u2</span><span class="o">/</span><span class="mi">16384</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4096</span> <span class="o">+</span> <span class="n">u2</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">768</span> <span class="o">+</span> <span class="n">u2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">320</span> <span class="o">-</span> <span class="mi">175</span> <span class="o">*</span> <span class="n">u2</span><span class="p">)))</span>

    <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">u2</span><span class="o">/</span><span class="mi">1024</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">256</span> <span class="o">+</span> <span class="n">u2</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">128</span><span class="o">+</span> <span class="n">u2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">74</span> <span class="o">-</span> <span class="mi">47</span> <span class="o">*</span> <span class="n">u2</span><span class="p">)))</span>

    <span class="n">delta_sigma</span> <span class="o">=</span> <span class="n">B</span> <span class="o">*</span> <span class="n">Sin_sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">Cos2sigma_m</span> <span class="o">+</span> <span class="p">(</span><span class="n">B</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">Cos_sigma</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">Cos2sigma_m</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">-</span> \
        <span class="p">(</span><span class="n">B</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="n">Cos2sigma_m</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sqr_sin_sigma</span><span class="p">)</span> <span class="o">*</span> \
        <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">Cos2sigma_m</span><span class="p">,</span><span class="mi">2</span> <span class="p">)</span> <span class="p">)))</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">-</span> <span class="n">delta_sigma</span><span class="p">)</span>

    <span class="n">alpha12</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lembda</span><span class="p">)),</span> \
        <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">U2</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lembda</span><span class="p">)))</span>

    <span class="n">alpha21</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lembda</span><span class="p">)),</span> \
        <span class="p">(</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U2</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">U2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lembda</span><span class="p">)))</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">alpha12</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">alpha12</span> <span class="o">=</span>  <span class="n">alpha12</span> <span class="o">+</span> <span class="n">two_pi</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">alpha12</span> <span class="o">&gt;</span> <span class="n">two_pi</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">alpha12</span> <span class="o">=</span> <span class="n">alpha12</span> <span class="o">-</span> <span class="n">two_pi</span>

    <span class="n">alpha21</span> <span class="o">=</span> <span class="n">alpha21</span> <span class="o">+</span> <span class="n">two_pi</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">alpha21</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">alpha21</span> <span class="o">=</span> <span class="n">alpha21</span> <span class="o">+</span> <span class="n">two_pi</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">alpha21</span> <span class="o">&gt;</span> <span class="n">two_pi</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">alpha21</span> <span class="o">=</span> <span class="n">alpha21</span> <span class="o">-</span> <span class="n">two_pi</span>

    <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">alpha12</span><span class="p">,</span>  <span class="n">alpha21</span>

    <span class="c"># END of Vincenty&#39;s Inverse formulae</span>


<span class="c">#----------------------------------------------------------------------------</span>
<span class="c"># Vincenty&#39;s Direct formulae                                                |</span>
<span class="c"># Given: latitude and longitude of a point (phi1, lembda1) and              |</span>
<span class="c"># the geodetic azimuth (alpha12)                                            |</span>
<span class="c"># and ellipsoidal distance in metres (s) to a second point,                 |</span>
<span class="c">#                                                                           |</span>
<span class="c"># Calculate: the latitude and longitude of the second point (phi2, lembda2) |</span>
<span class="c"># and the reverse azimuth (alpha21).                                        |</span>
<span class="c">#                                                                           |</span>
<span class="c">#----------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="vinc_pt"><a class="viewcode-back" href="../docs/shielding.html#vincenty.vinc_pt">[docs]</a><span class="k">def</span>  <span class="nf">vinc_pt</span><span class="p">(</span> <span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">phi1</span><span class="p">,</span> <span class="n">lembda1</span><span class="p">,</span> <span class="n">alpha12</span><span class="p">,</span> <span class="n">s</span> <span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the lat and long of projected point and reverse azimuth</span>
<span class="sd">    given a reference point and a distance and azimuth to project.</span>
<span class="sd">    lats, longs and azimuths are passed in decimal degrees</span>

<span class="sd">    Returns ( phi2,  lambda2,  alpha21 ) as a tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">alpha12</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">alpha12</span> <span class="o">=</span> <span class="n">alpha12</span> <span class="o">+</span> <span class="n">two_pi</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">alpha12</span> <span class="o">&gt;</span> <span class="n">two_pi</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">alpha12</span> <span class="o">=</span> <span class="n">alpha12</span> <span class="o">-</span> <span class="n">two_pi</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">f</span><span class="p">)</span>

    <span class="n">TanU1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">f</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span>
    <span class="n">U1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span> <span class="n">TanU1</span> <span class="p">)</span>
    <span class="n">sigma1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span> <span class="n">TanU1</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha12</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">Sinalpha</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha12</span><span class="p">)</span>
    <span class="n">cosalpha_sq</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">Sinalpha</span> <span class="o">*</span> <span class="n">Sinalpha</span>

    <span class="n">u2</span> <span class="o">=</span> <span class="n">cosalpha_sq</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">u2</span> <span class="o">/</span> <span class="mi">16384</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4096</span> <span class="o">+</span> <span class="n">u2</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">768</span> <span class="o">+</span> <span class="n">u2</span> <span class="o">*</span> \
        <span class="p">(</span><span class="mi">320</span> <span class="o">-</span> <span class="mi">175</span> <span class="o">*</span> <span class="n">u2</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">u2</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">256</span> <span class="o">+</span> <span class="n">u2</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">128</span> <span class="o">+</span> <span class="n">u2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">74</span> <span class="o">-</span> <span class="mi">47</span> <span class="o">*</span> <span class="n">u2</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

    <span class="c"># Starting with the approximation</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">A</span><span class="p">))</span>

    <span class="n">last_sigma</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">+</span> <span class="mf">2.0</span>  <span class="c"># something impossible</span>

    <span class="c"># Iterate the following three equations</span>
    <span class="c"># until there is no significant change in sigma</span>
    <span class="c"># two_sigma_m , delta_sigma</span>
    <span class="k">while</span> <span class="p">(</span> <span class="nb">abs</span><span class="p">(</span> <span class="p">(</span><span class="n">last_sigma</span> <span class="o">-</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.0e-9</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">two_sigma_m</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sigma1</span> <span class="o">+</span> <span class="n">sigma</span>

        <span class="n">delta_sigma</span> <span class="o">=</span> <span class="n">B</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">two_sigma_m</span><span class="p">)</span> \
            <span class="o">+</span> <span class="p">(</span><span class="n">B</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> \
            <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">two_sigma_m</span><span class="p">),</span> <span class="mi">2</span> <span class="p">)</span> <span class="o">-</span>  \
             <span class="p">(</span><span class="n">B</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">two_sigma_m</span><span class="p">)</span> <span class="o">*</span> \
            <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">),</span> <span class="mi">2</span> <span class="p">))</span> <span class="o">*</span>  \
            <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span> <span class="p">(</span><span class="n">two_sigma_m</span><span class="p">),</span> <span class="mi">2</span> <span class="p">)))))</span> \

        <span class="n">last_sigma</span> <span class="o">=</span> <span class="n">sigma</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">A</span><span class="p">))</span> <span class="o">+</span> <span class="n">delta_sigma</span>

    <span class="n">phi2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span> <span class="p">(</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha12</span><span class="p">)</span> <span class="p">),</span> \
        <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">f</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">Sinalpha</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>  \
        <span class="nb">pow</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha12</span><span class="p">),</span> <span class="mi">2</span><span class="p">))))</span>

    <span class="n">lembda</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha12</span> <span class="p">)),</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">-</span>  \
        <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span>  <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha12</span><span class="p">)))</span>

    <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="mi">16</span><span class="p">)</span> <span class="o">*</span> <span class="n">cosalpha_sq</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">+</span> <span class="n">f</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">cosalpha_sq</span> <span class="p">))</span>

    <span class="n">omega</span> <span class="o">=</span> <span class="n">lembda</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">C</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="n">Sinalpha</span> <span class="o">*</span>  \
        <span class="p">(</span><span class="n">sigma</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">two_sigma_m</span><span class="p">)</span> <span class="o">+</span> \
        <span class="n">C</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">two_sigma_m</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> <span class="p">)))</span>

    <span class="n">lembda2</span> <span class="o">=</span> <span class="n">lembda1</span> <span class="o">+</span> <span class="n">omega</span>

    <span class="n">alpha21</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span> <span class="p">(</span> <span class="n">Sinalpha</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">+</span>  \
        <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">U1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha12</span><span class="p">)))</span>

    <span class="n">alpha21</span> <span class="o">=</span> <span class="n">alpha21</span> <span class="o">+</span> <span class="n">two_pi</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">alpha21</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">alpha21</span> <span class="o">=</span> <span class="n">alpha21</span> <span class="o">+</span> <span class="n">two_pi</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">alpha21</span> <span class="o">&gt;</span> <span class="n">two_pi</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">alpha21</span> <span class="o">=</span> <span class="n">alpha21</span> <span class="o">-</span> <span class="n">two_pi</span>

    <span class="k">return</span> <span class="n">phi2</span><span class="p">,</span>  <span class="n">lembda2</span><span class="p">,</span>  <span class="n">alpha21</span>

    <span class="c"># END of Vincenty&#39;s Direct formulae</span>

<span class="c">##---------------------------------------------------------------------------</span>
<span class="c"># Notes:</span>
<span class="c">#</span>
<span class="c"># * &quot;The inverse formulae may give no solution over a line</span>
<span class="c">#       between two nearly antipodal points. This will occur when</span>
<span class="c">#       lembda ... is greater than pi in absolute value&quot;. (Vincenty, 1975)</span>
<span class="c">#</span>
<span class="c"># * In Vincenty (1975) L is used for the difference in longitude,</span>
<span class="c">#       however for consistency with other formulae in this Manual,</span>
<span class="c">#       omega is used here.</span>
<span class="c">#</span>
<span class="c"># * Variables specific to Vincenty&#39;s formulae are shown below,</span>
<span class="c">#       others common throughout the manual are shown in the Glossary.</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># alpha = Azimuth of the geodesic at the equator</span>
<span class="c"># U = Reduced latitude</span>
<span class="c"># lembda = Difference in longitude on an auxiliary sphere (lembda1 &amp; lembda2</span>
<span class="c">#               are the geodetic longitudes of points 1 &amp; 2)</span>
<span class="c"># sigma = Angular distance on a sphere, from point 1 to point 2</span>
<span class="c"># sigma1 = Angular distance on a sphere, from the equator to point 1</span>
<span class="c"># sigma2 = Angular distance on a sphere, from the equator to point 2</span>
<span class="c"># sigma_m = Angular distance on a sphere, from the equator to the</span>
<span class="c">#               midpoint of the line from point 1 to point 2</span>
<span class="c"># u, A, B, C = Internal variables</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># Sample Data</span>
<span class="c">#</span>
<span class="c"># Flinders Peak</span>
<span class="c"># -37o57&#39;03.72030&quot;</span>
<span class="c"># 144o25&#39;29.52440&quot;</span>
<span class="c"># Buninyong</span>
<span class="c"># -37o39&#39;10.15610&quot;</span>
<span class="c"># 143o55&#39;35.38390&quot;</span>
<span class="c"># Ellipsoidal Distance</span>
<span class="c"># 54,972.271 m</span>
<span class="c">#</span>
<span class="c"># Forward Azimuth</span>
<span class="c"># 306o52&#39;05.37&quot;</span>
<span class="c">#</span>
<span class="c"># Reverse Azimuth</span>
<span class="c"># 127o10&#39;25.07&quot;</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">##*******************************************************************</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">Wind Multipliers v0.3 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Geoscience Australia.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>